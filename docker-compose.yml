version: "3.9"

networks:
  nginx_proxy_net:
    driver: bridge

services:

  labyrinth:
    build: 
      context: ./laby
      args:
        - LABY_WORK_DIR=${LABY_WORK_DIR}
    container_name: labyrinthnavi
    entrypoint: uvicorn src.main:app --port ${LABY_PORT}
    networks:
      - nginx_proxy_net
    expose:
      - "${LABY_PORT}"
    environment:
      - LABY_PORT=${LABY_PORT}
      - TZ=Asia/Seoul

  nginxproxy:
    build: 
      context: ./nginxproxy
    container_name: reverseproxy
    volumes:
      - ./nginxproxy/logs:/var/log/nginx
    networks:
      - nginx_proxy_net
    depends_on:
      - labyrinth
    ports:
      - "3733:80/tcp"
    environment:
      - LABY_PORT=${LABY_PORT}
      - TZ=Asia/Seoul